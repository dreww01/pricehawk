# PriceHawk API - Test Requests
# Install VS Code "REST Client" extension to use this file
# Click "Send Request" above each request to execute

# =============================================================================
# VARIABLES - Update these with your values
# =============================================================================

@supabaseUrl = https://lfldxuvhkkmkqgcjefrp.supabase.co
@supabaseAnonKey = sb_publishable_xXCMojYW9HV__URwz_5ITA_SIyDvF_E
@apiUrl = http://localhost:5000

# =============================================================================
# SUPABASE AUTH ENDPOINTS
# =============================================================================

### 1. Sign Up - Create a new user
POST {{supabaseUrl}}/auth/v1/signup
apikey: {{supabaseAnonKey}}
Content-Type: application/json

{
  "email": "test@example.com",
  "password": "testpassword123"
}

### 2. Login - Get access token
# @name login
POST {{supabaseUrl}}/auth/v1/token?grant_type=password
apikey: {{supabaseAnonKey}}
Content-Type: application/json

{
  "email": "test@example.com",
  "password": "testpassword123"
}

###
@accessToken = {{login.response.body.access_token}}

### 3. Get Current User (via Supabase)
GET {{supabaseUrl}}/auth/v1/user
apikey: {{supabaseAnonKey}}
Authorization: Bearer {{accessToken}}

# =============================================================================
# HEALTH CHECK
# =============================================================================

### Health Check - No auth required
GET {{apiUrl}}/api/health

### Get Current User - Via our API
GET {{apiUrl}}/api/auth/me
Authorization: Bearer {{accessToken}}

# =============================================================================
# STORE DISCOVERY (NEW FLOW)
# =============================================================================

### Discover Shopify Store Products
POST {{apiUrl}}/api/stores/discover
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "url": "https://allbirds.com",
  "limit": 10
}

### Discover Shopify with Keyword Filter
POST {{apiUrl}}/api/stores/discover
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "url": "https://gymshark.com",
  "keyword": "shorts",
  "limit": 20
}

### Discover Amazon Store/Search
POST {{apiUrl}}/api/stores/discover
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "url": "https://www.amazon.com/s?k=wireless+headphones",
  "limit": 10
}

### Discover eBay Store
POST {{apiUrl}}/api/stores/discover
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "url": "https://www.ebay.com/sch/i.html?_nkw=laptop",
  "limit": 10
}

# =============================================================================
# TRACK PRODUCTS (After Discovery)
# =============================================================================

### Track Discovered Products
POST {{apiUrl}}/api/stores/track
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "group_name": "Wireless Headphones",
  "product_urls": [
    "https://www.amazon.com/dp/B0BXYCS74H",
    "https://www.amazon.com/dp/B09XXS8Y11"
  ],
  "alert_threshold_percent": 10
}

# =============================================================================
# PRODUCT MANAGEMENT
# =============================================================================

### List All Tracked Products
GET {{apiUrl}}/api/products
Authorization: Bearer {{accessToken}}

### Get Single Product (replace with actual product_id)
@productId = YOUR_PRODUCT_ID_HERE
GET {{apiUrl}}/api/products/{{productId}}
Authorization: Bearer {{accessToken}}

### Update Product
PUT {{apiUrl}}/api/products/{{productId}}
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "product_name": "Updated Product Name",
  "is_active": true
}

### Delete Product (soft delete)
DELETE {{apiUrl}}/api/products/{{productId}}
Authorization: Bearer {{accessToken}}

# =============================================================================
# PRICE SCRAPING & HISTORY
# =============================================================================

### Manual Scrape - Trigger immediate price check
POST {{apiUrl}}/api/scrape/manual/{{productId}}
Authorization: Bearer {{accessToken}}

### Get Price History
GET {{apiUrl}}/api/prices/{{productId}}/history?limit=50&offset=0
Authorization: Bearer {{accessToken}}

### Get Latest Price for Competitor
@competitorId = YOUR_COMPETITOR_ID_HERE
GET {{apiUrl}}/api/prices/latest/{{competitorId}}
Authorization: Bearer {{accessToken}}

### Worker Health Check
GET {{apiUrl}}/api/scrape/worker-health

# =============================================================================
# ERROR TESTING
# =============================================================================

### Test without token - Should fail with 403
GET {{apiUrl}}/api/products

### Test invalid URL (HTTP not HTTPS)
POST {{apiUrl}}/api/stores/discover
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "url": "http://example.com",
  "limit": 10
}

### Test non-existent product
GET {{apiUrl}}/api/products/00000000-0000-0000-0000-000000000000
Authorization: Bearer {{accessToken}}
