# PriceHawk API - Test Requests
# Install VS Code "REST Client" extension to use this file
# Click "Send Request" above each request to execute

# =============================================================================
# VARIABLES - Update these with your values
# =============================================================================

@apiUrl = http://localhost:8000

# =============================================================================
# HEALTH CHECK
# =============================================================================

### Health Check - No auth required
GET {{apiUrl}}/api/health

### Worker Health Check
GET {{apiUrl}}/api/scraper/scrape/worker-health

# =============================================================================
# AUTHENTICATION
# =============================================================================

### Sign Up - Create a new user
POST {{apiUrl}}/api/auth/signup
Content-Type: application/json

{
  "email": "test@example.com",
  "password": "testpassword123"
}

### Login - Get access token
# @name login
POST {{apiUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "test@example.com",
  "password": "testpassword123"
}

###
@accessToken = {{login.response.body.access_token}}

### Get Current User
GET {{apiUrl}}/api/auth/me
Authorization: Bearer {{accessToken}}

### Forgot Password
POST {{apiUrl}}/api/auth/forgot-password
Content-Type: application/json

{
  "email": "test@example.com"
}

### Reset Password (requires tokens from email link)
POST {{apiUrl}}/api/auth/reset-password
Content-Type: application/json

{
  "access_token": "YOUR_ACCESS_TOKEN_FROM_EMAIL",
  "refresh_token": "YOUR_REFRESH_TOKEN_FROM_EMAIL",
  "new_password": "newpassword123"
}

# =============================================================================
# ACCOUNT MANAGEMENT
# =============================================================================

### Get Account Settings
GET {{apiUrl}}/api/account/settings
Authorization: Bearer {{accessToken}}

### Change Password
POST {{apiUrl}}/api/account/change-password
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "current_password": "testpassword123",
  "new_password": "newpassword123"
}

### Change Email
POST {{apiUrl}}/api/account/change-email
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "new_email": "newemail@example.com"
}

### Delete Account
DELETE {{apiUrl}}/api/account/delete
Authorization: Bearer {{accessToken}}

# =============================================================================
# STORE DISCOVERY
# =============================================================================

### Discover Shopify Store Products
POST {{apiUrl}}/api/stores/discover
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "url": "https://allbirds.com",
  "limit": 10
}

### Discover Shopify with Keyword Filter
POST {{apiUrl}}/api/stores/discover
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "url": "https://gymshark.com",
  "keyword": "shorts",
  "limit": 20
}

# =============================================================================
# TRACK PRODUCTS
# =============================================================================

### Track Discovered Products
POST {{apiUrl}}/api/stores/track
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "group_name": "Gymshark Shorts",
  "product_urls": [
    "https://gymshark.com/products/shorts-1",
    "https://gymshark.com/products/shorts-2"
  ],
  "alert_threshold_percent": 10
}

# =============================================================================
# PRODUCT MANAGEMENT
# =============================================================================

### List All Tracked Products
GET {{apiUrl}}/api/products
Authorization: Bearer {{accessToken}}

### Get Single Product (replace with actual product_id)
@productId = YOUR_PRODUCT_ID_HERE
GET {{apiUrl}}/api/products/{{productId}}
Authorization: Bearer {{accessToken}}

### Update Product
PUT {{apiUrl}}/api/products/{{productId}}
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "product_name": "Updated Product Name",
  "is_active": true
}

### Delete Product (soft delete)
DELETE {{apiUrl}}/api/products/{{productId}}
Authorization: Bearer {{accessToken}}

# =============================================================================
# PRICE SCRAPING & HISTORY
# =============================================================================

### Manual Scrape - Trigger immediate price check
POST {{apiUrl}}/api/scraper/scrape/manual/{{productId}}
Authorization: Bearer {{accessToken}}

### Get Price History
GET {{apiUrl}}/api/scraper/prices/{{productId}}/history?limit=50&offset=0
Authorization: Bearer {{accessToken}}

### Get Latest Price for Competitor
@competitorId = YOUR_COMPETITOR_ID_HERE
GET {{apiUrl}}/api/scraper/prices/latest/{{competitorId}}
Authorization: Bearer {{accessToken}}

### Get Chart Data
GET {{apiUrl}}/api/scraper/prices/{{productId}}/chart-data?days=30
Authorization: Bearer {{accessToken}}

# =============================================================================
# ALERTS
# =============================================================================

### Get Alert Settings
GET {{apiUrl}}/api/alerts/settings
Authorization: Bearer {{accessToken}}

### Update Alert Settings
PUT {{apiUrl}}/api/alerts/settings
Authorization: Bearer {{accessToken}}
Content-Type: application/json

{
  "email_enabled": true,
  "digest_frequency": "daily",
  "threshold_percent": 5.0
}

# =============================================================================
# INSIGHTS
# =============================================================================

### Get All Insights
GET {{apiUrl}}/api/insights
Authorization: Bearer {{accessToken}}

# =============================================================================
# DASHBOARD
# =============================================================================

### Get Dashboard Stats
GET {{apiUrl}}/api/dashboard/stats
Authorization: Bearer {{accessToken}}

### Get Dashboard Activity
GET {{apiUrl}}/api/dashboard/activity
Authorization: Bearer {{accessToken}}

### Get Dashboard Products
GET {{apiUrl}}/api/dashboard/products
Authorization: Bearer {{accessToken}}

# =============================================================================
# EXPORT
# =============================================================================

### Export Price History to CSV
GET {{apiUrl}}/api/export/{{productId}}/csv
Authorization: Bearer {{accessToken}}

# =============================================================================
# ERROR TESTING
# =============================================================================

### Test without token - Should fail with 403
GET {{apiUrl}}/api/products

### Test non-existent product
GET {{apiUrl}}/api/products/00000000-0000-0000-0000-000000000000
Authorization: Bearer {{accessToken}}
